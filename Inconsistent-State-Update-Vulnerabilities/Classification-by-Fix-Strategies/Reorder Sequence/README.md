## Reorder Sequence
Reorder Sequence (Reorder Function Call Sequence or State Variable Update Sequence, 14.66%).
|Serial number| Reporting time |  Bug link  | Root cause | Exploitation method | Fix strategy  |
|    :---:    |      :---:     |    :---:    |      :---:     |      :---:     |      :---:     |
|1|2022-02-09|[2021-12-mellow#h-04](https://code4rena.com/reports/2021-12-mellow#h-04-aavevault-does-not-update-tvl-on-depositwithdraw)|The total value locked (TVL) is not promptly updated when users deposit or withdraw. | Wrong token share calculated using outdated TVL. | First update the TVL, then proceed with other operations when depositing or withdrawing tokens.
|2|2022-11-29|[2022-09-frax#h-01](https://code4rena.com/reports/2022-09-frax#h-01-wrong-accounting-logic-when-syncrewards-is-called-within-beforewithdraw-makes-withdrawals-impossible)| The syncRewards() function is not called to synchronize rewards before executing withdrawal operations. | An accounting logic error caused the nextRewards calculation to be inflated, resulting in overpayment of rewards. | Call syncRewards() before calling beforeWithdraw().
|3|2023-01-20|[2022-11-stakehouse#h-16](https://code4rena.com/reports/2022-11-stakehouse#h-16-reentrancy-vulnerability-in-giantmevandfeespoolwithdraweth)| beforeTokenTransfer() is called before the ETH transfer occurs. | After receiving ETH, the attacker used the unlocked claimRewards() function to perform multiple transactions, resulting in too many rewards being issued. | Perform the "idleETH -= _amount;" operation after burning the LP tokens.
|4|2023-01-20|[2022-11-stakehouse#h-08](https://code4rena.com/reports/2022-11-stakehouse#h-08-function-withdraweth-from-giantmevandfeespool-can-steal-most-of-eth-because-of-idleeth-is-reduced-before-burning-token)| The idleETH is decremented before LP token burning. | The reward calculation is wrong, and the attacker calls the withdrawETH() function to steal ETH. | Decrement idleETH only after token burning.
|5|2023-03-10|[2023-01-timeswap#h-03](https://code4rena.com/reports/2023-01-timeswap#h-03-the-collect-function-will-always-transfer-zero-fees-losing-_feespositions-without-receiving-fees)| The calculation of variables like long0Fees and long1Fees is executed only after the transferFees() function call. | The incorrect calculation of the long0Fees, long1Fees and other variables used to calculate fees caused the transfer fee to always be zero. | Calculate the actual values of long0Fees, long1Fees, and shortFees before calling transferFees().
|6|2023-04-18|[2022-12-tessera#h-04](https://code4rena.com/reports/2022-12-tessera#h-04-optimisticlistingseaportpropose-sets-pendingbalances-of-newly-added-proposer-instead-of-previous-one)| Update pendingBalances only after new proposal creation. | The old proposer loses the deposit, and the new proposer can repeat the proposal. | Update pendingBalances before calling _setListing().
|7|2023-05-01|[2023-02-malt#h-06](https://code4rena.com/reports/2023-02-malt#h-06-stabilizernodestabilize-uses-stale-globalimpliedcollateralservice-data-which-will-make-stabilize-incorrect)| Call syncGlobalCollateral() at the end of stabilize(). | Using an outdated collateralRatio for stabilization calculations can make stabilization operations inaccurate and may cause tokens to depeg. | Call impliedCollateralService() before stabilize() executes.
|8|2023-05-01|[2023-02-malt#h-05](https://code4rena.com/reports/2023-02-malt#h-05-_distributeprofit-will-use-the-stale-globalicswingtradercollateraldeficitswingtradercollateralratio-which-will-result-in-incorrect-profit-distribution)| The profit distribution ratio is calculated before updating the dependent values. | Using inaccurate values ​​when allocating profits leads to incorrect profit distribution, causing LPs (liquidity providers) to receive too much profit. | Call syncGlobalCollateral() before calling handleProfit().
|9|2023-05-01|[2023-02-malt#h-02](https://code4rena.com/reports/2023-02-malt#h-02-rewardthrottle-if-an-epoch-does-not-have-any-profit-then-there-may-not-be-rewards-for-that-epoch-at-the-start-of-the-next-epoch)| The location of the _fillInEpochGaps() call is incorrect. | fillInEpochGaps() did not correctly calculate and request rewards from overflowPool, resulting in lost rewards for unprofitable epochs. | Remove the call to fillInEpochGaps(). Or, move the call to checkRewardUnderflow() to the beginning of each new epoch. Or, restrict calls to fillInEpochGaps() to administrators only.
|10|2023-06-23|[2023-04-party#h-07](https://code4rena.com/reports/2023-04-party#h-07-initialethcrowdfund--reraiseethcrowdfund-batchcontributefor-function-may-not-refund-eth-which-leads-to-loss-of-funds)| Decrement the ethAvailable before each contributeFor() call. | When a contribution fails, the remaining ETH is not correctly calculated and refunded to the user, resulting in the user losing funds. | Move the ethAvailable decrement operation after the contributeFor() call.
|11|2023-09-07|[2023-01-popcorn#h-11](https://code4rena.com/reports/2023-01-popcorn#h-11-protocol-loses-fees-because-highwatermark-is-updated-every-time-someone-deposit-withdraw-mint)| The highWaterMark is updated whenever a user deposits, withdraws, or mints. | The inability to properly track the progress of earnings makes it impossible for the agreement to correctly charge for earnings when they are available. | Adjust the highWaterMark update timing to occur only during initial deposits and after successful fee collections.
|12|2023-11-29|[2023-07-axelar#h-01](https://code4rena.com/reports/2023-07-axelar#h-01-expressreceivetoken-can-be-abused-using-reentry)| expressReceiveTokenWithData() delays state updates until after token transfers. | Stealing funds in cross-chain transfers using reentry attacks. | Call _setExpressReceiveTokenWithData() in advance.
|13|2023-12-29|[2023-08-dopex#h-05](https://code4rena.com/reports/2023-08-dopex#h-05-users-can-get-immediate-profit-when-deposit-and-redeem-in-perpetualatlanticvaultlp)| Call previewDeposit() before updateFunding(). | The value of the assets calculated at the time of redemption included additional funds for an undeserved profit. | Move the updateFunding() call to before previewDeposit().
|14|2024-05-03|[2024-03-abracadabra-money#h-01](https://code4rena.com/reports/2024-03-abracadabra-money#h-01-anyone-making-use-of-the-magiclps-twap-to-determine-token-prices-will-be-exploitable)| Reserves updates precede TWAP updates. | Manipulate reserve values prior to TWAP updates, manipulate prices and profit on subsequent trades. | Advance the execution position of the _twapUpdate() function.
|15|2024-05-22|[2024-03-revert-lend#h-02](https://code4rena.com/reports/2024-03-revert-lend#h-02-risk-of-reentrancy-onerc721received-function-to-manipulate-collateral-token-configs-shares)|The cleanupLoan() function is called before _updateAndCheckCollateral(). | A reentry attack is utilized to update debt shares multiple times, manipulate borrowing caps, and prevent other users from borrowing. | Call cleanupLoan() after _updateAndCheckCollateral().
|16|2024-07-28|[2024-06-playfi-proleague#h-2](https://github.com/code-423n4/zenith-portfolio)|  Send the referral commission before updating state variables (totalClaimed, totalLicenses). | The attacker used a reentrancy attack to purchase quantities exceeding the permitted limit. | Process referral commission transfers after updating state variables (totalClaimed, totalLicenses).
|17|2024-07-13|[2024-06-strateg-proleague#h-4](https://github.com/code-423n4/zenith-portfolio/tree/main/reports)| lastClaimTotalRewards only updates when feeClaimable is greater than 0. | The attacker transferred the balances of the two tokenIds and stole the rewards from the contract multiple times by repeatedly claiming the rewards. | Update the variables lastClaimTotalRewards and timeClaimed before the feeClaimable check.
