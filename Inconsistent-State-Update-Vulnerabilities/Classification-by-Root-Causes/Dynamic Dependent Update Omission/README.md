## Dynamic Dependent Update Omission
Dynamic Dependent Update Omission (Omission of Update for Dynamic Operation Dependent State Variables, 47.41%).
|Serial number| Reporting time |  Bug link  | Root cause | Exploitation method | Fix strategy  |
|    :---:    |      :---:     |    :---:    |      :---:     |      :---:     |      :---:     |
|1|2021-08-17|[2021-07-wildcredit#h-02](https://code4rena.com/reports/2021-07-wildcredit#h-02-lendingpairliquidateaccount-does-not-accrue-and-update-cumulativeinterestrate)| The accumulated interest rate is not updated during account liquidation.| Interest calculation error, the borrower bypassed interest payment through self liquidation. | Revise the previous accumulated interest rate update method.
|2|2021-09-15|[2021-07-pooltogether#h-03](https://code4rena.com/reports/2021-07-pooltogether#h-03-setyieldsource-leads-to-temporary-wrong-results)|Token balances are not promptly updated when the contract switches revenue sources. | The calculation of balance and shares is incorrect, resulting in users receiving undeserved shares. | Remove calls to the external functions transferFunds and setYieldSource, and restrict swapYieldSource to owner-only access.
|3|2021-11-30|[2021-09-sushitrident-2#h-03](https://code4rena.com/reports/2021-09-sushitrident-2#h-03-concentratedliquiditypoolmanagers-incentives-can-be-stolen)|The reclaimIncentive function does not decrement the incentive.rewardsUnclaimed field. | The attacker repeatedly called the recaaimIncentive function to steal all tokens in the incentive pool. | Decrement the incentive.rewardsUnclaimed field by the withdrawn amount.
|4|2022-01-26|[2021-09-defiprotocol#h-02](https://code4rena.com/reports/2021-09-defiprotocol#h-02-basketsolauctionburn-a-failed-auction-will-freeze-part-of-the-funds)|The auctionBurn function does not update ibRatio when burning auction bonds. | The calculation of total supply was incorrect, resulting in some assets being frozen. | Update ibRatio based on the withdrawn amount in the auctionBurn function.
|5|2021-11-23|[2021-10-mochi#h-06](https://code4rena.com/reports/2021-10-mochi#h-06-referrer-can-drain-referralfeepoolv0)|The claimRewardAsMochi function does not reduce the user's reward balance. | The referrer can repeatedly claim the same reward until the fee pool is exhausted. | Decrement the user's reward balance in the claimRewardAsMochi function.
|6|2022-01-21|[2021-11-bootfinance#h-03](https://code4rena.com/reports/2021-11-bootfinance#h-03-swaputilssol-wrong-implementation)| The tokenPrecisionMultipliers used in price calculations is not computed in real-time.| The attacker use old tokenPrecision Multipliers for transactions before the target price takes effect. | Change tokenPrecisionMultipliers to real-time calculation.
|7|2022-02-09|[2021-12-mellow#h-04](https://code4rena.com/reports/2021-12-mellow#h-04-aavevault-does-not-update-tvl-on-depositwithdraw)|The total value locked (TVL) is not promptly updated when users deposit or withdraw. | Wrong token share calculated using outdated TVL. | First update the TVL, then proceed with other operations when depositing or withdrawing tokens.
|8|2023-03-07|[2021-12-amun#h-01](https://code4rena.com/reports/2021-12-amun#h-01-unused-erc20-tokens-are-not-refunded-and-can-be-stolen-by-attacker)|The remaining tokens are not refunded. | Incorrect calculation and refund of remaining underlying tokens. | Calculate and trade only the required token amount, then refund any remaining tokens to the user after the transaction.
|9|2022-05-03|[2021-12-vader#h-10](https://code4rena.com/reports/2021-12-vader#h-10-previousprices-is-never-updated-upon-syncing-token-price)|The syncVaderPrice function does not update previousPrices after synchronizing prices. | The attacker uses the lagged previousPrices to calculate the liquidity assessment and manipulate the liquidity share. | Update the previousPrices array after price synchronization.
|10|2022-05-24|[2022-02-concur#h-01](https://code4rena.com/reports/2022-02-concur#h-01-wrong-reward-token-calculation-in-masterchef-contract)|The reward distribution for old pools is not updated when adding new token pools. | Users are unable to accurately calculate the rewards they deserve. | Call massUpdate() to refresh rewards for all existing pools before adding a new one.
|11|2022-06-02|[2022-04-backd#h-02](https://code4rena.com/reports/2022-04-backd#h-02-function-lockfunds-in-topupactionlibrary-can-cause-serious-fund-lose-fee-and-capped-bypass-its-not-calling-stakervaultincreaseactionlockedbalance-when-transfers-stakes)| The actionLockedBalances[payer] is not updated for the payer when transferring stakes.| stakedAndActionLockedBalanceOf() calculates wrong balance | Call stakerVault.increaseActionLockedBalance to update after transferring funds.
|12|2023-02-17|[2022-12-tigris#h-01](https://code4rena.com/reports/2022-12-tigris#h-01-locksol-assets-deposited-with-lockextendlock-function-are-lost)|The Lock.extendLock function increases the locked amount but does not update the total locked amount. | An accounting error resulted in the inability to release locked assets added through the extendLock() function in the future. | Update totalLocked[_asset] in Lock.extendLock.
|13|2023-01-13|[2022-08-frax#h-01](https://code4rena.com/reports/2022-08-frax#h-01-any-borrower-with-bad-debt-can-be-liquidated-multiple-times-to-lock-funds-in-the-lending-pair)|The liquidateClean function does not update the borrower's loan shares. | The borrower's remaining share is not deducted from its actual debt. | Include the remaining shares in _sharesToLiquidate after liquidation.
|14|2023-01-18|[2022-02-anchor#h-01](https://code4rena.com/reports/2022-02-anchor#h-01-spend-limit-on-owner-can-be-bypassed)|The spend_limit is not decremented based on spent amounts. | config.spend_limit was not reduced after each spend, causing all subsequent spends to bypass the limit and the attacker could call the spend function multiple times. | After the spending operation is successful, reduce the value of config.spend_limit accordingly.
|15|2023-01-20|[2022-11-stakehouse#h-10](https://code4rena.com/reports/2022-11-stakehouse#h-10-giantmevandfeespoolbringunusedethbackintogiantpool-function-loses-the-addition-of-the-idleeth-which-allows-attackers-to-steal-most-of-eth-from-the-giant-pool)| The idleETH is not incremented when returning ETH. | The idleETH is not increased correctly, allowing the attacker to call the bringUnusedETHBackIntoGiantPool() function to steal ETH. | Increment the idleETH value accordingly in the bringUnusedETHBackIntoGiantPool() function.
|16|2023-01-20|[2022-11-stakehouse#h-06](https://code4rena.com/reports/2022-11-stakehouse#h-06-bringunusedethbackintogiantpool-can-cause-stuck-ether-funds-in-giant-pool)|The variable idleETH is not synchronized. | An error in the calculation of idleETH caused ETH withdrawn from the vault to be permanently locked in the Giant Pool. | Add an update for idleETH.
|17|2023-02-28|[2023-01-ondo#h-01](https://code4rena.com/reports/2023-01-ondo#h-01-loss-of-user-funds-when-completing-cash-redemptions)|The variable totalBurned is not updated. | The amount received by the user during subsequent redemption is inaccurate, resulting in financial loss. | After refunding refundedAmt, update totalBurned to deduct the refunded amount.
|18|2023-02-28|[2022-12-forgeries#h-01](https://code4rena.com/reports/2022-12-forgeries#h-01-admin-does-not-have-to-wait-to-call-lastresorttimelockownerclaimnft)| The recoverTimelock is not updated with each lottery draw. | Administrators can bypass the waiting time limit by repeatedly calling lastResortTimelockOwnerClaimNFT() without waiting for the specified time lock period to expire. | Update recoverTimelock with every lottery draw.
|19|2023-04-27|[2022-11-paraspace#h-01](https://code4rena.com/reports/2022-11-paraspace#h-01-data-corruption-in-nftfloororacle-denial-of-service)|The index in feederPositionMap is not updated when removing oracle addresses. | A calculation error caused an out-of-bounds access error when deleting the feeder. | Synchronize updates to oracle indexes moved to new positions in feederPositionMap during deletion.
|20|2023-05-22|[2023-01-astaria#h-17](https://code4rena.com/reports/2023-01-astaria#h-17-function-processepoch-in-publicvault-would-revert-when-most-of-the-users-withdraw-their-funds-because-of-the-underflow-for-new-yintercept-calculation)|The latest interest is not counted into the total assets. | The next cycle cannot be started correctly and users' funds cannot be withdrawn. | Call accrue() at the beginning of processEpoch() to account for the latest interest.
|21|2023-05-22|[2023-01-astaria#h-16](https://code4rena.com/reports/2023-01-astaria#h-16-when-public-vault-a-buys-out-public-vault-bs-lien-tokens-it-does-not-increase-public-vault-as-liensopenforepoch-which-would-result-in-the-lien-tokens-not-being-repaid)|liensOpenForEpoch is not incremented when purchasing liens. | When Public Vault A acquired lien tokens, liensOpenForEpoch was not calculated correctly, resulting in an overflow when repaying. | Add a call to increaseEpochLienCount().
|22|2023-05-22|[2023-01-astaria#h-06](https://code4rena.com/reports/2023-01-astaria#h-06-buying-out-corrupts-the-slope-of-a-vault-reducing-rewards-of-lps)| The variable for interest calculation remains unupdated during buyout operations. | The slope of the new lien tokens is not added to the total slope of the public vault, borrowers are not paid interest, and liquidity providers cannot receive rewards. | Add the new lien slope back to the total slope after buyout completion.
|23|2023-08-01|[2023-03-polynomial#h-07](https://code4rena.com/reports/2023-03-polynomial#h-07-missing-totalfunds-update-in-liquiditypools-openshort-causing-liquiditypool-token-holder-to-lose-a-portion-of-their-token-value)|The deducted transaction fees (feesCollected - externalFee) are not added to totalFunds after calculating net transaction fees. | The totalFunds calculation error affects the available funds in the liquidity pool, causing liquidity providers to lose part of their funds. | Add the net collected transaction fees to totalFunds in the openShort() function.
|24|2023-08-01|[2023-03-polynomial#h-05](https://code4rena.com/reports/2023-03-polynomial#h-05-uneven-deduction-of-performance-fee-causes-some-kangaroovault-users-to-lose-part-of-their-token-value)| The performance fee is not deducted during liquidation. | The fees deducted when closing a position were not distributed correctly, causing users to lose part of the token value when withdrawing. | Deduct performanceFee from premiumCollected in getTokenPrice().
|25|2023-08-01|[2023-03-polynomial#h-04](https://code4rena.com/reports/2023-03-polynomial#h-04-kangaroovaultremovecollateral-updates-storage-without-actually-removing-collateral-resulting-in-lost-collateral)| Collateral data is marked as removed on-chain but not actually withdrawn. | The amount of collateral is reduced in storage but not deducted from the transaction, resulting in the loss of collateral. | Call removeCollateral() to withdraw collateral while updating usedFunds.
|26|2023-08-01|[2023-03-polynomial#h-01](https://code4rena.com/reports/2023-03-polynomial#h-01-exchange_liquidate-function-can-cause-liquidator-to-burn-too-much-powerperp-tokens)|The update to totalCollateralReturned is missing. | Liquidators burn excessive powerPerp tokens, resulting in a loss of funds. | Calculate the token amount corresponding to the collateral actually received by the liquidator, then match the burned token quantity with the liquidator's actual received collateral value.
|27|2023-08-07|[2023-05-particle#h-02](https://code4rena.com/reports/2023-05-particle#h-02-treasury-fee-is-not-collected-in-withdrawethwithinterest)|The treasury fee is not deducted from the interest paid to lenders. | The treasury fees receivable were not deducted from the interest due to the lenders, resulting in the loss of these fees. | Accrue the earned interest to the interestAccrued mapping.
|28|2023-09-18|[2023-05-maia#h-28](https://code4rena.com/reports/2023-05-maia#h-28-removing-a-bribeflywheel-from-a-gauge-does-not-remove-the-reward-asset-from-the-rewards-depo-making-it-impossible-to-add-a-new-flywheel-with-the-same-reward-token)|The reward records for this Flywheel are not removed simultaneously when removing the BribeFlywheel. | It is not possible to add new Flywheel incentives that would affect the protocol functionality. | Remove the reward token assets associated with the Flywheel.
|29|2023-10-05|[2023-07-basin#h-01](https://code4rena.com/reports/2023-07-basin#h-01-pumps-are-not-updated-in-the-shift-and-sync-functions-allowing-oracle-manipulation)|The oracle Pumps is not updated promptly. | Manipulate the reserves of the current block and thus tamper with the prophecy machine data. | Update the Pumps data immediately after each reserve change.
|30|2023-12-29|[2023-08-dopex#h-08](https://code4rena.com/reports/2023-08-dopex#h-08-the-peg-stability-module-can-be-compromised-by-forcing-lowerdepeg-to-revert)| totalWethDelegated is not reduced when users withdraw WETH. | Reducing WETH reserves incorrectly resulted in a rollback due to insufficient reserves when attempting to restore the price. | Update totalWethDelegated in the withdraw function.
|31|2024-01-16|[2023-12-initcapital#h-01](https://code4rena.com/reports/2023-12-initcapital#h-01-liquidations-can-be-prevented-by-frontrunning-and-liquidating-1-debt-or-more-due-to-wrong-assumption-in-pos_manager)|The user's latest debt status is not updated. | Debt shares are miscalculated, which in turn causes subsequent liquidation operations to fail. | Update the user's latest debt record in the _repay() function.
|32|2024-01-26|[2023-12-particle#h-02](https://code4rena.com/reports/2023-12-particle#h-02-openposition-use-stale-feegrowthinside0lastx128feegrowthinside1lastx128)|The fee accumulator value is not synchronized with the pool's current state. | Inaccurate values of fee increases were used to calculate fees over the period of borrowing, which resulted in borrowers paying additional fees at the time of repayment. | Call collectLiquidity() to synchronize the fee accumulator.
|33|2024-04-19|[2024-03-gitcoin#h-01](https://code4rena.com/reports/2024-03-gitcoin#h-01-usertotalstaked-invariant-will-be-broken-due-to-vulnerable-implementations-in-release)|userTotalStaked is not updated when releasing funds. | The actual pledge amount does not match userTotalStaked, thus miscalculating the withdrawn funds at the time of withdrawal. | Update the userTotalStaked in release().
|34|2024-06-25|[2024-03-dittoeth#h-07](https://code4rena.com/reports/2024-03-dittoeth#h-07-valid-redemption-proposals-can-be-disputed-by-decreasing-collateral)|updatedAt is not updated when creating proposals. | The collateral ratio was calculated incorrectly and was lower than that recorded in other valid redemption proposals, thus successfully initiating an invalid dispute and obtaining penalty fees. | Update updatedAt in the decreaseCollateral() function.
|35|2024-08-06|[2024-05-olas#h-01](https://code4rena.com/reports/2024-05-olas#h-01-pointssumslope-not-updated-after-nominee-removal-and-votes-revocation)|pointsSum.slope is not updated when nominees are removed. | Errors occurred in the calculation of voting weights, affecting the accuracy of the governance mechanism. | Update pointsSum.slope in removeNominee()
|36|2024-07-19|[2024-01-curves#h-02](https://code4rena.com/reports/2024-01-curves#h-02-unrestricted-claiming-of-fees-due-to-missing-balance-updates-in-feesplitter)|Update accumulated rewards only during trades, not transfers. | The fee offset for the new account was not updated, resulting in incorrect calculation of the fees due to the account. | Call onBalanceChange() to update accumulated rewards in all balance-changing operations.
|37|2024-07-25|[2024-04-gondi#h-07](https://code4rena.com/reports/2024-04-gondi#h-07-deploywithdrawalqueue-need-to-clear-_queueaccountinglastqueueindex)|The data in _queueAccounting[lastQueueIndex] is not cleared when deploying a new withdrawal queue. | queueClaimAll() used outdated data and incorrectly allocated the total amount due. | Clear _queueAccounting[lastQueueIndex] data in deployWithdrawalQueue().
|38|2024-07-25|[2024-04-gondi#h-06](https://code4rena.com/reports/2024-04-gondi#h-06-function-settlewithbuyout-does-not-call-loanmanagerloanliquidation-during-a-buyout)|The loan pool accounting records are not updated when lenders buy out loans via the settleWithBuyout() function. | The accounting in the pool was not handled correctly, which affected the balance and profit distribution in the pool. | Call loanLiquidation() within settleWithBuyout() to ensure accounting data updates.
|39|2024-12-08|[2024-jul-gemnify-proleague#h-2](https://github.com/code-423n4/zenith-portfolio/tree/main/reports)|ps.tokenBalances[] is not updated in the safeTransfer() function. | The actual amount received returned to users when withdrawing or transferring funds is incorrect. | Call transferOut() in claimFundingFees() to update token balances during fund transfers.
|40|2024-08-06|[2024-05-olas#h-01](https://code4rena.com/reports/2024-05-olas#h-01-pointssumslope-not-updated-after-nominee-removal-and-votes-revocation)|pointsSum.slope is not updated when nominees are removed. | The slope for the removed nominees is still included in the calculation, resulting in an inaccurate calculation of the voting weight. | Update pointsSum.slope in removeNominee().
|41|2024-08-16|[2024-07-munchables#h-01](https://code4rena.com/reports/2024-07-munchables#h-01-single-plot-can-be-occupied-by-multiple-renters)| toiletState[tokenId].plotId is not updated when users transfer tokens to another plot. | Allowing multiple tenants to occupy the same plot and causing errors in reward calculations. | Update toiletState[tokenId].plotId in the transferToUnoccupiedPlot() function.


### subtype (state synchronization in permission management)
|Serial number| Reporting time |  Bug link  | Root cause | Exploitation method | Fix strategy  |
|    :---:    |      :---:     |    :---:    |      :---:     |      :---:     |      :---:     |
|42|2021-08-30|[2021-05-visorfinance#h-02](https://code4rena.com/reports/2021-05-visorfinance#h-02-nft-transfer-approvals-are-not-removed-and-cannot-be-revoked-thus-leading-to-loss-of-nft-tokens)|The granted NFT transaction authorization is not revoked.|The authorization has not been revoked, and the authorized person can transfer NFTs repeatedly. | Modify the status variables that control the granting or revocation of permissions.
|43|2021-08-30|[2021-05-visorfinance#h-03](https://code4rena.com/reports/2021-05-visorfinance#h-03-approval-for-nft-transfers-is-not-removed-after-transfer) | Failure to clear the approval authorization for NFT resulted in authorized agents being able to transfer the NFT multiple times. | The NFT authorization is not reset.| Reset the approval on transfer.
|44|2022-04-20|[2021-11-unlock#h-03](https://code4rena.com/reports/2021-11-unlock#h-03-mixintransfersoltransferfrom-wrong-implementation-can-potentially-allows-attackers-to-reverse-transfer-and-cause-fund-loss-to-the-users)|The key manager is not reset. | The attacker repeats the transaction after the key transfer, either returning the key to themselves or transferring it to other recipients. | Reset the key manager in the transferFrom function.
|45|2022-04-20|[2021-11-unlock#h-04](https://code4rena.com/reports/2021-11-unlock#h-04-approvals-not-cleared-after-key-transfer)|The _setKeyManagerOf function does not clear single-token approvals. | The attacker repeatedly transfers the key back to themselves from the victim without clearing the previous approval after the key transfer. | Call the _clearApproval function to clear the approval.
|46|2022-12-13|[2022-07-ens#h-02](https://code4rena.com/reports/2022-07-ens#h-02-the-expiry-of-the-parent-node-can-be-smaller-than-the-one-of-a-child-node-violating-the-guarantee-policy)|Child node states are not considered when unwrapping the parent node. | When unblocking child nodes, the original expiration time management mechanism was disrupted. | Add proper constraints when setting child node expiration times and destroy the parent node's CANNOT_UNWRAP permission.
|47|2022-10-26|[2022-08-olympus#h-03](https://code4rena.com/reports/2022-08-olympus#h-03-trsry-front-runnable-setapprovalfor)|The current allowance is not decremented based on existing withdrawal records. | The attacker can front-run the approval change process to withdraw the previously approved funds early. | Decrement the current allowance based on existing withdrawal records when setting a new allowance.
|48|2022-11-17|[2022-09-party#h-05](https://code4rena.com/reports/2022-09-party#h-05-arbitrarycallsproposalsol-and-listonopenseaproposalsol-safeguards-can-be-bypassed-by-cancelling-in-progress-proposal-allowing-the-majority-to-steal-nft)|The NFT approval is not revoked. | The attacker cancels the proposal in progress, thereby bypassing the protection measures and stealing the NFT. | Clear the authorization after the proposal is canceled.
|49|2023-04-05|[2022-07-golom#h-04](https://code4rena.com/reports/2022-07-golom#h-04-old-delegatee-not-deleted-when-delegating-to-new-tokenid)|The old delegatee is not removed. | The old delegators were not deleted, resulting in the same user being able to double-count voting rights by delegating the same token multiple times. | remove the user's old delegation before executing a new operation.
|50|2023-04-11|[2023-01-rabbithole#h-02](https://code4rena.com/reports/2023-01-rabbithole#h-02-protocol-fees-can-be-withdrawn-multiple-times-in-erc20quest)|The fee withdrawal status is not updated. | The withdrawFee() function does not have any protection mechanism, allowing the protocol fee to be withdrawn multiple times. | Track the protocol fee withdrawal status.
|51|2024-06-12|[2024-05-loop#h-01](https://code4rena.com/reports/2024-05-loop#h-01-availability-of-deposit-invariant-can-be-bypassed)|The state variable totalLpETH is not locked to equal totalSupply. | Pre- and post-operations (sandwich attack) to donate ETH and directly obtain lpETH. | Limit the claimedAmount calculation to only the ETH amount obtained from LRT swaps.
|52|2024-06-17|[2024-04-dyad#h-01](https://code4rena.com/reports/2024-04-dyad#h-01-design-flaw-and-mismanagement-in-vault-licensing-leads-to-double-counting-in-collateral-ratios-and-positions-collateralized-entirely-with-kerosine)|The keroseneVault is not authorized to the KerosineManager. | The attacker registers the same asset to both management systems at the same time, causing the asset to be counted twice. | Manage keroseneVault and regular vault in separate mappings, used for price calculation and authorization management respectively.
|53|2024-07-28|[2024-06-playfi-proleague#h-1](https://github.com/code-423n4/zenith-portfolio/tree/main/reports)|The variable limiting user purchase quantity is not updated after license purchase. | The attacker calls the claimLicensePartner() or claimLicensePublic() functions multiple times to repeatedly purchase licenses without restriction. | Accurately record each user's purchase quantity to prevent overbuying.
|54|2024-09-03|[2024-07-benddao#h-03](https://code4rena.com/reports/2024-07-benddao#h-03-erc721decreaseisolatesupplyonliquidate-missing-clear-lockeraddr)|The NFT post-liquidation state is not fully reset. | The NFT cannot be unlocked successfully, which in turn affects the subsequent NFT extraction operations. | Update tokenData.lockerAddr to address(0) during liquidation.
|55|2024-10-18|[2024-08-superposition#h-02](https://code4rena.com/reports/2024-08-superposition#h-02-unrevoked-approvals-allow-nft-recovery-by-previous-owner)|The previous getApproved[_tokenId] approval status is not revoked. | Approval was not revoked after the NFT was transferred, and the previous owner transferred the NFT back to himself through repeated transactions. | Clear the approval status after transferring the NFT.