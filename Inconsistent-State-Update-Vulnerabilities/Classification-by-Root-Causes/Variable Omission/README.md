## Variable Omission
Variable Omission (Omission of Critical State Variables,10.34%)
|Serial number| Reporting time |  Bug link  | Root cause | Exploitation method | Fix strategy  |
|    :---:    |      :---:     |    :---:    |      :---:     |      :---:     |      :---:     |
|1|2021-05-03|[2021-04-marginswap#h-07](https://code4rena.com/reports/2021-04-marginswap#h-07-accountholdstoken-is-never-set)| There is a lack of mapping to avoid repeatedly depositing the same token. | Multiple deposits of the same token resulted in duplicate token records in the account. holdingTokens array. | Set the holdsToken map in addHolding() to distinguish different tokens.
|2|2023-01-31|[2022-12-backed#h-01](https://code4rena.com/reports/2022-12-backed#h-01-borrowers-may-earn-auction-proceeds-without-filling-the-debt-shortfall)| The variable for accumulating and storing the remaining debt after each auction is lacking. | The debt was not properly liquidated, resulting in the auction proceeds going directly to the borrower. | Increase the record of the debt gap through the newly added _shortfall variable.
|3|2023-04-11|[2023-03-neotokyo#h-01](https://code4rena.com/reports/2023-03-neotokyo#h-01-updating-a-pools-total-points-doesnt-affect-existing-stake-positions-for-rewards-calculation)| There is a lack of variables for tracking the reward distribution of each point. | The reward calculation did not correctly reflect the changes in the total points of the pool, affecting the user's rewards. | Introduce the rewardPerTokenStored variable to track the reward distribution for each point.
|4|2023-04-27|[2023-03-mute#h-01](https://code4rena.com/reports/2023-03-mute#h-01-bond-max-buyer-might-end-up-buying-the-max-buy-of-the-next-epoch)| A variable for tracking the current period number is missing. | max_buy was miscalculated, causing users to incorrectly buy the next period's worth of bonds at a lower price than expected. | Add a variable "currentEpoch" to track the current cycle number.
|5|2023-06-23|[2023-04-party#h-08](https://code4rena.com/reports/2023-04-party#h-08-vetoproposal-user-can-veto-multiple-times-so-every-proposal-can-be-vetoed-by-any-user-that-has-a-small-amount-of-votes)| A mapping for tracking whether a veto vote has been cast is missing. | Users can vote down the same proposal multiple times, allowing users with a small number of votes to veto any proposal. | Add a hasVoted map to track whether each (party, proposalId, address) triple has already cast a veto vote.
|6|2023-08-07|[2023-05-particle#h-06](https://code4rena.com/reports/2023-05-particle#h-06-marketplace-may-call-onerc721received-and-create-a-lien-during-buynftfrommarket-creating-divergence)| There is a lack of a flag for indicating that the purchase operation of the contract is underway. | onERC721Received() creates two pledge rights in the intermediate state, resulting in the same NFT being bound to two different pledge rights. | Set a _marketBuyFlow flag to indicate that the contract is conducting a market purchase operation.
|7|2023-11-16|[2023-07-tapioca#h-20](https://code4rena.com/reports/2023-07-tapioca#h-20-_liquidateuser-should-not-re-use-the-same-minimum-swap-amount-out-for-multiple-liquidation)| When liquidate() performs clearing operations for multiple users, it uses the same minAssetAmount value and lacks variables for different records. | The liquidation amount was inaccurate, resulting in losses to both the liquidator and the agreement. | Modify the liquidate() function to enable liquidators to pass multiple minAssetAmount parameter values, so that each value corresponds to a different borrower.
|8|2024-03-20|[2024-01-renft#h-07](https://code4rena.com/reports/2024-01-renft#h-07-attacker-can-lock-lender-nfts-and-erc20-in-the-safe-if-the-offer-is-set-to-partial)| Different hash values corresponding to different orders are lacking. | Creating multiple similar partially filled orders results in the same order hash value, which allows the partial asset to be locked. | Introduce a random number (nonce) for each order to ensure that the orderHash is unique.
|9|2024-06-24|[2024-05-bakerfi#h-04](https://code4rena.com/reports/2024-05-bakerfi#h-04-multiple-swap-lack-slippage-protection)|  The "amountOutMinimum" parameter is missing for slippage protection. | The attacker can manipulate the transaction price through a front-running attack, causing the output amount of the swap to be lower than expected. | Pass the correct amountOutMinimum value.
|10|2024-07-25|[2024-04-gondi#h-17](https://code4rena.com/reports/2024-04-gondi#h-17-refinancefulladdnewtranche-reusing-a-lenders-signature-leads-to-unintended-behavior)| A type field is missing in the signature to distinguish different operation types. | The attacker used the signature of refinanceFull() to prepend addNewTranche(), causing the loan amount to be approximately twice the original amount. | Add a type field in the RenegotiationOffer to distinguish different operation types.
|11|2024-07-13|[2024-06-strateg-proleague#h-1](https://github.com/code-423n4/zenith-portfolio/tree/main/reports)| There is a lack of a list of processed tokens to ensure that the same generation of tokens will not be counted multiple times. | The attacker repeatedly calculated the balance of Token B, inflated the total assets, and then obtained more shares at a low price. | Add deduplication logic in the oracleExit() function to ensure that the same generation of coins is not calculated multiple times.
|12|2024-09-13|[2024-09-legion-evm-zenith#h-3](https://github.com/code-423n4/zenith-portfolio/tree/main/reports)| A Boolean flag indicating whether the funds have been withdrawn is missing. | The withdrawCapital() function can be called multiple times until all remaining capital in the contract is withdrawn. | Add a Boolean flag tokensWithdrawn to indicate whether funds have been withdrawn.
